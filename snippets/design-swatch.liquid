{%- liquid 
    assign variation_required = product.metafields.custom.variation.value
    assign products_all = product.collections[0].products | sort: "title"
    assign products = product | sort
    assign titles = product.metafields.custom.short_name.value | sort
    for prod in products_all
        unless titles contains prod.metafields.custom.short_name.value
            if prod.metafields.custom.variation.value == variation_required
                assign prd = prod | sort
                assign title = prod.metafields.custom.variation.value | sort
                assign products = products | concat: prd
                assign titles = titles | concat: title
            endif
        endunless
    endfor
-%}

<div style="margin-top: 0.5rem; display: flex; flex-direction: row;">
    {% for prod in products %}
      {{ prod.title }}
        {% if prod.metafields.custom.thumbnail.value != blank %}
            {% if prod.id == product.id %}
                <div style="display: flex; align-items: center; justify-content: center; overflow: hidden;">
                    {{ prod.metafields.custom.thumbnail.value | image_url: width: 200, height: 200| image_tag: class: 'shrink-0 object-cover rounded-full w-20 h-20' }}
                </div>
            {% else %}
                <a style="display: flex; align-items: center; justify-content: center; overflow: hidden; border-style: solid;" href={{prod.url}}>
                    {{ prod.metafields.custom.thumbnail.value | image_url: width: 200, height: 200| image_tag: class: 'shrink-0 object-cover w-20 h-20 rounded-full' }}
                </a>
            {% endif %}
        {% endif %}
    {% endfor %}
</div>


